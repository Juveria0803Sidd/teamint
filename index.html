<body>
    <div class="login-container">
        <h2>Login with Azure AD</h2>
        <button id="login">Login</button>
        <button id="showTeams" style="display:none;">Show Teams</button>
    </div>
    <div id="teamsDisplay" style="padding: 20px; display: none;">
        <h3>Teams and Channels:</h3>
        <ul id="teamsList"></ul>
    </div>

    <script src="https://alcdn.msauth.net/browser/2.17.0/js/msal-browser.min.js"></script>
    <script>
        const msalConfig = {
            auth: {
                clientId: '9eac5713-ea50-4c18-bac7-5839a30f0101',
                authority: 'https://login.microsoftonline.com/04a705d7-fbf2-41bc-bb46-19685d7a1db8',
                redirectUri: 'https://sdes11.github.io/teamint/'
            }
        };

        const msalInstance = new msal.PublicClientApplication(msalConfig);
        const loginRequest = {
            scopes: ["User.Read", "Channel.ReadBasic.All", "Team.ReadBasic.All"]
        };

        document.getElementById('login').addEventListener('click', function() {
            msalInstance.loginPopup(loginRequest)
                .then(loginResponse => {
                    console.log('Logged in:', loginResponse);
                    alert('Login successful!');
                    document.getElementById('showTeams').style.display = 'block';
                })
                .catch(error => {
                    console.error('Login failed:', error);
                    alert('Login failed, check the console for more details.');
                });
        });

        document.getElementById('showTeams').addEventListener('click', function() {
            fetchTeamsChannels();
        });

        function fetchTeamsChannels() {
            msalInstance.acquireTokenSilent(loginRequest).then(tokenResponse => {
                fetch('https://graph.microsoft.com/v1.0/me/joinedTeams', {
                    headers: {
                        'Authorization': 'Bearer ' + tokenResponse.accessToken
                    }
                })
                .then(response => response.json())
                .then(data => {
                    const teamsList = document.getElementById('teamsList');
                    teamsList.innerHTML = ''; // Clear previous entries
                    data.value.forEach(team => {
                        let li = document.createElement('li');
                        li.textContent = team.displayName;
                        teamsList.appendChild(li);
                    });
                    document.getElementById('teamsDisplay').style.display = 'block';
                })
                .catch(error => {
                    console.error('Error fetching teams:', error);
                });
            }).catch(error => {
                console.log('Token acquisition failed:', error);
            });
        }
    </script>
</body>
